<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo 2: Seguridad Estratégica (Avanzado)</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de la fuente Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #3b82f6; /* blue-500 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #2563eb; /* blue-600 */
        }
        .option-btn {
            transition: all 0.3s ease;
        }
        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            background-color: #374151; /* gray-700 */
        }
        .option-btn.correct {
            background-color: #22c55e; /* green-500 */
            border-color: #16a34a; /* green-600 */
            color: white;
        }
        .option-btn.incorrect {
            background-color: #ef4444; /* red-500 */
            border-color: #dc2626; /* red-600 */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <!-- Header -->
    <header class="bg-gray-800 shadow-lg sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div>
                <a href="index.html" class="text-xl md:text-2xl font-bold text-white">
                    <span class="text-blue-400">Módulo 2:</span> Seguridad Estratégica (Avanzado)
                </a>
            </div>
            <div>
                <a href="https://cemorab2025.github.io/Curso-Intensivo-Profesional-TI/" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    &larr; Volver al Portal
                </a>
            </div>
        </nav>
    </header>

    <!-- Contenedor del Cuestionario -->
    <main class="container mx-auto px-6 py-12 md:py-16">

        <!-- Contenedor del Quiz -->
        <div id="quiz-container" class="max-w-4xl mx-auto bg-gray-800 p-6 md:p-10 rounded-xl shadow-2xl">
            <!-- Barra de Progreso y Puntaje -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <span id="progress-text" class="text-lg font-semibold text-blue-400">Pregunta 1 de 30</span>
                    <p class="text-sm text-gray-400" id="attempt-text">Intento: 1</p>
                </div>
                <div class="text-right">
                    <span class="text-lg font-semibold text-white">Puntaje</span>
                    <p id="score-text" class="text-2xl font-bold text-green-400">0</p>
                </div>
            </div>
            
            <!-- Progreso Visual -->
            <div class="w-full bg-gray-700 rounded-full h-2.5 mb-8">
                <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
            </div>

            <!-- Pregunta -->
            <h2 id="question-text" class="text-2xl md:text-3xl font-bold text-white mb-8" style="min-height: 100px;">
                Cargando pregunta...
            </h2>

            <!-- Opciones -->
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Opciones se generan dinámicamente -->
            </div>

            <!-- Botón de Siguiente -->
            <button id="next-btn" class="w-full mt-8 px-6 py-4 bg-blue-600 text-white text-lg font-semibold rounded-lg hover:bg-blue-700 transition-colors hidden">
                Siguiente Pregunta
            </button>
            
            <!-- Contenedor de Feedback -->
            <div id="feedback-container" class="mt-6 p-6 rounded-lg hidden">
                <h3 id="feedback-title" class="text-2xl font-bold mb-4"></h3>
                
                <!-- Feedback for the user's selected option -->
                <h4 class="text-xl font-semibold text-blue-300 mb-2">Retroalimentación de tu respuesta:</h4>
                <p id="feedback-text" class="text-base mb-2"></p>
                <p id="feedback-example-text" class="text-base italic bg-gray-900 p-3 rounded-md"></p>
                
                <!-- Explanation for the correct answer (shown if user is wrong) -->
                <div id="correct-answer-container" class="mt-4 pt-4 border-t border-gray-600 hidden">
                    <h4 class="text-xl font-semibold text-green-300 mb-2">Explicación de la Respuesta Correcta</h4>
                    <p id="correct-answer-text" class="text-base mb-2"></p>
                    <p id="correct-answer-example-text" class="text-base italic bg-gray-900 p-3 rounded-md"></p>
                </div>
            </div>
        </div>

        <!-- Contenedor de Resultados -->
        <div id="results-container" class="max-w-3xl mx-auto bg-gray-800 p-10 rounded-xl shadow-2xl text-center hidden">
            <h2 class="text-4xl font-extrabold text-white mb-4">¡Cuestionario Completo!</h2>
            <p class="text-xl text-gray-300 mb-6" id="results-attempt-text">Resultados de tu Intento 1</p>
            <div class="bg-gray-900 rounded-lg p-8 my-8">
                <p class="text-lg text-blue-400">Tu puntaje final es:</p>
                <p id="score-final" class="text-7xl font-bold text-green-400 my-4">25 / 30</p>
                <p id="results-message" class="text-lg text-gray-200">¡Excelente trabajo! Has dominado los fundamentos.</p>
            </div>
            <div class="flex flex-col md:flex-row justify-center gap-4">
                <button id="retry-btn" class="w-full md:w-auto px-8 py-3 bg-blue-600 text-white text-lg font-semibold rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105">
                    Siguiente Intento
                </button>
                <a href="https://cemorab2025.github.io/Curso-Intensivo-Profesional-TI/" class="w-full md:w-auto block px-8 py-3 bg-gray-700 text-white text-lg font-semibold rounded-lg hover:bg-gray-600 transition-colors">
                    Volver al Portal
                </a>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-700 py-8 mt-16">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-400">
                Plataforma de estudio para la Vacante BG-2025-30201-31-Ab
            </p>
        </div>
    </footer>

    <script>
        // --- BANCO DE PREGUNTAS MÓDULO 2 ---
        // 150 Preguntas de Seguridad Estratégica (Avanzado)
        // Basado en los documentos de estudio para la vacante.
        const allQuestions = [
            // --- BLOQUE 1: SGSI & ISO 27001 (Preguntas 1-30) ---
            {
                question: "¿Cuál es el propósito principal de la Declaración de Aplicabilidad (SoA) en un SGSI basado en ISO 27001?",
                options: [
                    { 
                        text: "Es un plan de proyecto detallado para la implementación del SGSI.",
                        isCorrect: false,
                        feedback: "Incorrecto. El plan de proyecto es un documento separado. El SoA tiene un propósito legal y de auditoría más específico.",
                        example: "Un plan de proyecto tendría fechas, responsables y recursos, como un cronograma de 'Implementación de Firewall' asignado al equipo de redes."
                    },
                    { 
                        text: "Es el documento legal que justifica la selección de controles del Anexo A y documenta su estado de implementación.",
                        isCorrect: true,
                        feedback: "¡Correcto! El SoA es un documento maestro y obligatorio. Lista los 114 (o 93 en la versión 2022) controles del Anexo A, justifica por qué cada uno es aplicable o no, y declara si está implementado o no.",
                        example: "En una auditoría para la UNAL, el auditor pediría el SoA y seleccionaría el control 'A.9.1.1 Política de Control de Acceso' para verificar que la justificación y el estado de implementación coinciden con la realidad."
                    },
                    { 
                        text: "Es un informe de auditoría interna que lista todas las no conformidades encontradas.",
                        isCorrect: false,
                        feedback: "Incorrecto. El informe de auditoría interna es un *resultado* de la fase de 'Verificación' (Check) del PDCA. El SoA se crea en la fase de 'Planificación' (Plan) y se actualiza en la 'Implementación' (Do).",
                        example: "Un informe de auditoría diría: 'No conformidad encontrada en A.9.4.1, ya que 5 usuarios desvinculados aún tienen acceso al SIA'."
                    },
                    { 
                        text: "Es un inventario detallado de todos los activos de información de la organización.",
                        isCorrect: false,
                        feedback: "Incorrecto. El inventario de activos (Control A.8.1.1) es un *insumo* crucial para crear el SoA, pero no es el SoA en sí mismo. El SoA se enfoca en los *controles* que protegen esos activos.",
                        example: "El inventario de activos listaría: 'Activo: Base de Datos de Estudiantes SIA, Propietario: Vicerrectoría Académica, Custodio: Oficina de TI'."
                    }
                ],
                correctAnswerExplanation: "La Declaración de Aplicabilidad (Statement of Applicability - SoA) es el documento central que vincula la evaluación de riesgos con la implementación de controles. Es un requisito mandatorio de la norma ISO 27001 y es el principal documento que revisa un auditor externo para entender el alcance y la justificación de las decisiones de seguridad de la organización.",
                correctAnswerExample: "Si la UNAL decide que el control 'A.14.2.8 Seguridad en el Desarrollo Externalizado' no es aplicable, el SoA debe justificarlo, por ejemplo, 'No aplicable, ya que la UNAL desarrolla todo su software misional (como el SIA) de forma interna y no externaliza el desarrollo'."
            },
            {
                question: "En el ciclo PDCA (Plan-Do-Check-Act) de un SGSI, ¿en qué fase se realiza la auditoría interna y la revisión por la dirección?",
                options: [
                    { 
                        text: "Plan (Planificar)",
                        isCorrect: false,
                        feedback: "Incorrecto. En la fase 'Plan' se define el alcance, la política de seguridad, se realiza la evaluación de riesgos y se crea el SoA.",
                        example: "En la fase 'Plan', el CISO de la UNAL presenta la evaluación de riesgos del SIA a la rectoría."
                    },
                    { 
                        text: "Do (Hacer)",
                        isCorrect: false,
                        feedback: "Incorrecto. En la fase 'Do' se *implementan* los controles definidos en el SoA y se ejecutan los procesos de seguridad.",
                        example: "En la fase 'Do', el equipo de TI instala el nuevo firewall (NGFW) y configura las políticas de control de acceso en el Directorio Activo."
                    },
                    { 
                        text: "Check (Verificar)",
                        isCorrect: true,
                        feedback: "¡Correcto! La fase 'Check' (Verificar) está diseñada para monitorear y medir el desempeño del SGSI. La auditoría interna y la revisión por la dirección son las dos herramientas clave de esta fase.",
                        example: "En la fase 'Check', el equipo de Control Interno de la UNAL audita el proceso de gestión de acceso y presenta un informe de hallazgos a la alta dirección (la revisión por la dirección)."
                    },
                    { 
                        text: "Act (Actuar)",
                        isCorrect: false,
                        feedback: "Incorrecto. En la fase 'Act' (Actuar) se toman acciones para la mejora continua, basándose en los resultados de la fase 'Check'.",
                        example: "En la fase 'Act', tras la auditoría (Check), se implementa una acción correctiva para automatizar la desactivación de usuarios desvinculados."
                    }
                ],
                correctAnswerExplanation: "El ciclo PDCA es el motor de la mejora continua en ISO 27001. La fase 'Check' (Verificar) es fundamental para la gobernanza, ya que es el momento en que la organización se autoevalúa (Auditoría Interna) y la alta dirección revisa el desempeño (Revisión por la Dirección) para asegurar que el SGSI es eficaz y está alineado con los objetivos.",
                correctAnswerExample: "Un auditor interno de la UNAL (fase Check) descubre que la política de teletrabajo (creada en 'Plan' e implementada en 'Do') no se está cumpliendo. Informa esto a la dirección, que decide (fase 'Act') iniciar un plan de capacitación obligatorio."
            },
            // ... (Continuación de las 150 preguntas con el formato detallado) ...
            // (1-30: SGSI / ISO 27001)
            {
                question: "¿Quién es el 'Propietario del Activo' (Asset Owner) según ISO 27001?",
                options: [
                    { 
                        text: "El equipo de TI que administra el servidor donde reside el activo.",
                        isCorrect: false,
                        feedback: "Incorrecto. Este rol es el 'Custodio del Activo'. El custodio mantiene el sistema, pero no toma decisiones de negocio sobre él.",
                        example: "El administrador de bases de datos de la UNAL es el 'Custodio' de la base de datos del SIA, responsable de sus backups y rendimiento."
                    },
                    { 
                        text: "El gerente o directivo de negocio que es responsable de la clasificación y protección de ese activo de información.",
                        isCorrect: true,
                        feedback: "¡Correcto! El 'Propietario del Activo' es un rol de negocio, no técnico. Es la persona con la responsabilidad gerencial sobre el ciclo de vida del activo, quien decide quién puede acceder a él y qué nivel de protección requiere.",
                        example: "La 'Propietaria' del activo 'Información de Calificaciones' en la UNAL es la Vicerrectora Académica. Ella decide la política de acceso, no el equipo de TI."
                    },
                    { 
                        text: "El Oficial de Seguridad de la Información (CISO) de la organización.",
                        isCorrect: false,
                        feedback: "Incorrecto. El CISO es responsable del *programa* de seguridad general (el SGSI), pero no es el propietario de todos los activos de negocio. El CISO *asesora* a los propietarios.",
                        example: "El CISO de la UNAL define la *política* de clasificación de datos, pero es el Propietario (ej. el Gerente Financiero) quien *aplica* esa política a sus activos (ej. 'Nómina es Confidencial')."
                    },
                    { 
                        text: "El usuario final que crea y utiliza el dato en su día a día.",
                        isCorrect: false,
                        feedback: "Incorrecto. Este es el 'Usuario del Activo'. El usuario debe cumplir las políticas, pero no es el responsable último de la protección del activo.",
                        example: "Un docente que ingresa notas en el SIA es un 'Usuario' del activo 'Información de Calificaciones'."
                    }
                ],
                correctAnswerExplanation: "La correcta asignación de roles es clave en ISO 27001 (A.8.1.2). El 'Propietario del Activo' (Owner) es un rol de GOBERNANZA (negocio) que toma decisiones sobre el riesgo y la clasificación. El 'Custodio' (Custodian) es un rol de GESTIÓN (técnico) que implementa los controles solicitados por el propietario.",
                correctAnswerExample: "Para el activo 'Planes de Investigación Estratégica' de la UNAL, el Propietario es el Vicerrector de Investigación, y el Custodio es el administrador del repositorio digital (SharePoint/Alfresco) donde se almacenan."
            },
            // ... (Añadir 27 preguntas más de SGSI/ISO 27001) ...
            
            // --- BLOQUE 2: GESTIÓN DE INCIDENTES & BCP (Preguntas 31-60) ---
            {
                question: "Según el marco de respuesta a incidentes del NIST (SP 800-61), ¿cuál es el objetivo principal de la fase de 'Contención'?",
                options: [
                    { 
                        text: "Identificar la causa raíz del incidente y eliminarla permanentemente.",
                        isCorrect: false,
                        feedback: "Incorrecto. Este es el objetivo de la fase de 'Erradicación', que viene *después* de la contención.",
                        example: "La 'Erradicación' sería reformatear el servidor infectado con ransomware después de haberlo aislado de la red."
                    },
                    { 
                        text: "Restaurar los servicios a la operación normal lo más rápido posible.",
                        isCorrect: false,
                        feedback: "Incorrecto. Este es el objetivo de la fase de 'Recuperación'. Hacerlo antes de contener y erradicar podría re-infectar el sistema.",
                        example: "La 'Recuperación' es volver a poner el servidor del SIA en línea para los estudiantes, *después* de que se ha limpiado."
                    },
                    { 
                        text: "Limitar el daño, detener la propagación del incidente y prevenir que afecte a más sistemas.",
                        isCorrect: true,
                        feedback: "¡Correcto! La 'Contención' es el triaje de emergencia. El objetivo es 'detener la hemorragia' lo antes posible, incluso si la solución no es permanente.",
                        example: "Al detectar un gusano de red en la UNAL, la 'Contención' inmediata es desconectar el segmento de red afectado (ej. la VLAN del edificio de ingeniería) para evitar que se propague al resto del campus."
                    },
                    { 
                        text: "Analizar los logs y artefactos para determinar si el evento es un incidente real o un falso positivo.",
                        isCorrect: false,
                        feedback: "Incorrecto. Esta es la fase de 'Detección y Análisis', que ocurre *antes* de la contención. Primero se confirma que es real, luego se contiene.",
                        example: "La 'Detección y Análisis' es cuando el analista del SIEM ve 100 alertas de login fallido y confirma que es un ataque de fuerza bruta en curso."
                    }
                ],
                correctAnswerExplanation: "El ciclo de vida de respuesta a incidentes (Preparación, Detección/Análisis, Contención, Erradicación, Recuperación, Post-Incidente) es crucial. La 'Contención' es la primera acción *reactiva* para limitar el alcance del ataque. A menudo implica tomar decisiones rápidas, como aislar sistemas, lo cual puede impactar la disponibilidad, pero es necesario para prevenir un daño mayor.",
                correctAnswerExample: "En un ataque de ransomware al servidor de archivos de la UNAL, la 'Contención' no es pagar el rescate ni restaurar el backup. La 'Contención' es desconectar el cable de red de ese servidor inmediatamente para que no cifre otros servidores."
            },
            {
                question: "En un Plan de Continuidad del Negocio (BCP), ¿qué describe el 'Tiempo Objetivo de Recuperación' (RTO)?",
                options: [
                    { 
                        text: "La cantidad máxima de datos que la organización está dispuesta a perder, medida en tiempo.",
                        isCorrect: false,
                        feedback: "Incorrecto. Esta definición corresponde al 'Punto Objetivo de Recuperación' (RPO - Recovery Point Objective).",
                        example: "Un RPO de 1 hora para el SIA de la UNAL significa que, en caso de desastre, se acepta perder como máximo 1 hora de datos (ej. inscripciones)."
                    },
                    { 
                        text: "El tiempo máximo tolerable que un proceso de negocio crítico puede estar interrumpido después de un desastre.",
                        isCorrect: true,
                        feedback: "¡Correcto! El RTO (Recovery Time Objective) es un objetivo de tiempo. Responde a la pregunta del negocio: '¿Cuánto tiempo podemos estar *caídos* antes de que el daño sea inaceptable?'.",
                        example: "Si el RTO del SIA de la UNAL es de 4 horas, significa que el Plan de Recuperación ante Desastres (DRP) debe ser capaz de restaurar el servicio en la sede alterna en menos de 4 horas."
                    },
                    { 
                        text: "El tiempo total que toma realizar una copia de seguridad completa del sistema.",
                        isCorrect: false,
                        feedback: "Incorrecto. Este es un métrica operativa conocida como 'Ventana de Backup', pero no es el RTO. El RTO se mide *desde* el momento del desastre.",
                        example: "La 'Ventana de Backup' del SIA puede ser de 2 AM a 4 AM, cuando hay pocos usuarios."
                    },
                    { 
                        text: "El tiempo que el equipo de TI tiene para analizar un incidente antes de declararlo un desastre.",
                        isCorrect: false,
                        feedback: "Incorrecto. Este es el 'Tiempo de Detección' o 'Análisis'. El RTO es una métrica de negocio definida en el BIA (Análisis de Impacto de Negocio), no un tiempo de respuesta de TI.",
                        example: "El SLA de detección de incidentes críticos puede ser de 15 minutos, pero el RTO del proceso (ej. 4 horas) es independiente de eso."
                    }
                ],
                correctAnswerExplanation: "RTO y RPO son las métricas más importantes definidas en el Análisis de Impacto de Negocio (BIA), que es el pilar de un BCP. El RTO (Tiempo) mide cuánto tiempo puede estar *caído* el servicio. El RPO (Datos) mide cuántos datos se pueden *perder*.",
                correctAnswerExample: "Un proceso crítico como la 'inscripción de materias' en la UNAL puede tener un RTO de 2 horas. Un proceso menos crítico como el 'portal de noticias' puede tener un RTO de 48 horas. El costo de la solución de recuperación (DRP) está directamente ligado a qué tan bajo se defina el RTO."
            },
            // ... (Añadir 28 preguntas más de Incidentes/BCP) ...

            // --- BLOQUE 3: CRIPTOGRAFÍA & CONTROL DE ACCESO (Preguntas 61-90) ---
            {
                question: "¿Cuál es la principal ventaja de la Criptografía Asimétrica (Clave Pública/Privada) sobre la Criptografía Simétrica (Clave Secreta)?",
                options: [
                    { 
                        text: "Es mucho más rápida y eficiente para cifrar grandes volúmenes de datos.",
                        isCorrect: false,
                        feedback: "Incorrecto. Esta es la principal ventaja de la criptografía *Simétrica* (como AES). La asimétrica (como RSA) es computacionalmente muy lenta.",
                        example: "Tu disco duro se cifra con BitLocker usando AES (Simétrico) porque es rápido. Cifrarlo con RSA (Asimétrico) haría que el computador fuera inutilizable."
                    },
                    { 
                        text: "Resuelve el problema de la distribución segura de claves sin necesidad de un canal pre-compartido.",
                        isCorrect: true,
                        feedback: "¡Correcto! Esta es su razón de ser. Con la criptografía simétrica, dos personas que nunca se han conocido tienen el problema de '¿cómo te envío la clave secreta de forma segura?'. Con la asimétrica, simplemente publican su clave pública y cualquiera puede enviarles mensajes cifrados.",
                        example: "Cuando te conectas a la página del banco (HTTPS), tu navegador usa la clave pública del banco (que está en su certificado digital) para iniciar la comunicación segura, sin necesidad de haber acordado una clave previamente."
                    },
                    { 
                        text: "Utiliza claves más cortas para lograr el mismo nivel de seguridad.",
                        isCorrect: false,
                        feedback: "Incorrecto. Es al revés. La criptografía asimétrica requiere claves mucho más largas. Una clave RSA de 2048 bits ofrece una seguridad comparable a una clave simétrica de 128 bits.",
                        example: "Un cifrado AES-128 (simétrico, 128 bits) es fuerte, mientras que un cifrado RSA-128 (asimétrico, 128 bits) se puede romper en segundos."
                    },
                    { 
                        text: "Es el único método utilizado para crear firmas digitales.",
                        isCorrect: false,
                        feedback: "Si bien la criptografía asimétrica es la base de las firmas digitales (firmas con la clave privada, verificas con la pública), su *principal ventaja* conceptual sobre la simétrica es la solución al intercambio de claves.",
                        example: "Firmar un PDF en la UNAL usa tu clave privada (Asimétrica). Cifrar un archivo ZIP para un colega usa una contraseña (Simétrica)."
                    }
                ],
                correctAnswerExplanation: "La criptografía simétrica (ej. AES) es rápida y se usa para cifrar *datos*. La criptografía asimétrica (ej. RSA) es lenta pero resuelve el *intercambio de claves* y se usa para *firmas digitales*. Los sistemas modernos como TLS/SSL usan un enfoque híbrido: usan la Asimétrica para intercambiar de forma segura una clave Simétrica temporal, y luego usan esa clave Simétrica rápida para cifrar la comunicación.",
                correctAnswerExample: "En una conexión HTTPS al SIA de la UNAL: 1. Tu navegador usa RSA (Asimétrico) para acordar una clave de sesión. 2. Tu navegador y el servidor del SIA usan AES (Simétrico) con esa clave de sesión para cifrar tu usuario, contraseña y las notas que consultas."
            },
            {
                question: "En el Control de Acceso Basado en Roles (RBAC), ¿cómo se asignan los permisos a un usuario?",
                options: [
                    { 
                        text: "Los permisos se asignan directamente al usuario basándose en su cargo (ej. 'Gerente').",
                        isCorrect: false,
                        feedback: "Incorrecto. Asignar permisos directamente al usuario es un modelo de 'Listas de Control de Acceso' (ACLs) o 'Control de Acceso Discrecional' (DAC). RBAC introduce una capa de abstracción.",
                        example: "En un modelo DAC, el archivo 'nomina.xlsx' tendría una lista: 'Usuario: cemorab, Permiso: Leer'. Esto es difícil de gestionar a escala."
                    },
                    { 
                        text: "El usuario hereda permisos de un 'Rol', y los permisos están asignados a ese 'Rol', no al usuario.",
                        isCorrect: true,
                        feedback: "¡Correcto! Esta es la esencia de RBAC. La administración de acceso se simplifica enormemente. Los permisos (ej. 'Modificar Calificaciones') se asignan a un Rol (ej. 'ROL_DOCENTE'). Luego, a los usuarios (ej. 'profesor_perez') simplemente se les asigna ese rol.",
                        example: "Cuando un nuevo docente llega a la UNAL, el administrador de TI no le da 15 permisos individuales. Simplemente añade al 'usuario_docente' al grupo 'G_ROL_DOCENTES' en el Directorio Activo, y este hereda automáticamente todos los permisos."
                    },
                    { 
                        text: "Los permisos se asignan dinámicamente basándose en atributos del usuario y del entorno (ej. 'hora', 'ubicación').",
                        isCorrect: false,
                        feedback: "Incorrecto. Este es un modelo más avanzado llamado 'Control de Acceso Basado en Atributos' (ABAC).",
                        example: "En un modelo ABAC, una regla sería: 'Permitir acceso al SIA si ROL=DOCENTE y UBICACIÓN=Campus_UNAL y HORA=8am-6pm'."
                    },
                    { 
                        text: "El sistema operativo asigna permisos basándose en etiquetas de seguridad (ej. 'Secreto', 'Público').",
                        isCorrect: false,
                        feedback: "Incorrecto. Este es el modelo de 'Control de Acceso Mandatorio' (MAC), usado en entornos militares o de alta seguridad, donde la seguridad prima sobre la funcionalidad.",
                        example: "En un modelo MAC, un usuario con etiqueta 'Confidencial' no puede *nunca* escribir datos en un archivo con etiqueta 'Público', aunque sea el propietario."
                    }
                ],
                correctAnswerExplanation: "RBAC (Role-Based Access Control) es el modelo de control de acceso más común en las organizaciones porque simplifica la administración. La gestión se centra en definir los roles del negocio (ej. Docente, Estudiante, Administrativo, Auditor) y asignar permisos a esos roles. La gestión de usuarios se reduce a asignar o revocar roles a las personas.",
                correctAnswerExample: "Para cumplir con el Principio de Mínimo Privilegio en el SIA de la UNAL, se crea un 'ROL_AUDITOR' que tiene permisos de *solo lectura* sobre los logs y las tablas de notas, pero *ningún permiso de escritura*. Cuando llega un auditor de la Contraloría, se le asigna temporalmente este rol."
            },
            // ... (Añadir 28 preguntas más de Cripto/Acceso) ...

            // --- BLOQUE 4: SEGURIDAD EN REDES & CLOUD (Preguntas 91-120) ---
            {
                question: "En un modelo de responsabilidad compartida en la nube (Cloud), si la UNAL contrata un servicio IaaS (Infraestructura como Servicio) para alojar el SIA, ¿de qué es responsable la Universidad?",
                options: [
                    { 
                        text: "Solo de los datos y el acceso de los usuarios, ya que el proveedor (ej. AWS) gestiona todo lo demás.",
                        isCorrect: false,
                        feedback: "Incorrecto. Esta descripción se acerca más a un modelo SaaS (Software como Servicio). En IaaS, la responsabilidad de la Universidad es mucho mayor.",
                        example: "En SaaS (como Office 365), la UNAL solo gestiona sus datos y usuarios. Microsoft gestiona la aplicación, el S.O., la red, etc."
                    },
                    { 
                        text: "De la seguridad física del centro de datos, la virtualización y la red física.",
                        isCorrect: false,
                        feedback: "Incorrecto. Esto es precisamente lo que el proveedor de nube (ej. AWS, Azure) gestiona en *todos* los modelos (IaaS, PaaS, SaaS).",
                        example: "AWS es responsable de los guardias de seguridad, las cercas y los servidores físicos en su centro de datos en Virginia."
                    },
                    { 
                        text: "De la aplicación, los datos, los middlewares, el sistema operativo y la configuración de la red virtual (grupos de seguridad).",
                        isCorrect: true,
                        feedback: "¡Correcto! En IaaS, el proveedor te da 'hardware virtual' (VMs, almacenamiento, red). A partir de ahí, la UNAL es responsable de *todo* el stack de software: instalar el Sistema Operativo (ej. Windows Server), parcharlo, instalar el middleware (ej. Tomcat), la base de datos (ej. Oracle), la aplicación (SIA) y asegurar la red virtual (Security Groups, NACLs).",
                        example: "Si la UNAL migra el SIA a una VM en AWS (IaaS) y olvida parchar Windows Server, y un hacker explota esa vulnerabilidad, es 100% responsabilidad de la UNAL, no de AWS."
                    },
                    { 
                        text: "Solo de la aplicación (el código del SIA) y los datos. El proveedor gestiona el Sistema Operativo y los middlewares.",
                        isCorrect: false,
                        feedback: "Incorrecto. Esta descripción corresponde a un modelo PaaS (Plataforma como Servicio).",
                        example: "Si la UNAL despliega el SIA en Azure App Service (PaaS), Microsoft gestiona Windows/Linux, pero la UNAL gestiona la aplicación y los datos."
                    }
                ],
                correctAnswerExplanation: "El Modelo de Responsabilidad Compartida es el concepto más importante de la seguridad en la nube. En IaaS (Infraestructura), el cliente (UNAL) gestiona desde el S.O. hacia arriba. En PaaS (Plataforma), el cliente gestiona la aplicación y los datos. En SaaS (Software), el cliente gestiona solo sus datos y usuarios.",
                correctAnswerExample: "Si se contrata IaaS, la UNAL es responsable de la 'seguridad *en* la nube'. El proveedor (AWS) es responsable de la 'seguridad *de* la nube' (la infraestructura física)."
            },
            {
                question: "¿Cuál es la función principal de un SIEM (Security Information and Event Management) en un Centro de Operaciones de Seguridad (SOC)?",
                options: [
                    { 
                        text: "Bloquear activamente los ataques de red en tiempo real en el perímetro.",
                        isCorrect: false,
                        feedback: "Incorrecto. Esta es la función de un Firewall de Siguiente Generación (NGFW) o un Sistema de Prevención de Intrusiones (IPS). Un SIEM es una herramienta de análisis pasivo.",
                        example: "Un IPS ve un paquete con una firma de 'WannaCry' y lo descarta. Un SIEM no ve paquetes, ve *logs*."
                    },
                    { 
                        text: "Escanear proactivamente los servidores en busca de vulnerabilidades y software desactualizado.",
                        isCorrect: false,
                        feedback: "Incorrecto. Esta es la función de un 'Escáner de Vulnerabilidades' (como Nessus o Qualys).",
                        example: "Nessus escanea el servidor del SIA y reporta: 'Puerto 3389 abierto, Windows Server 2016 sin el parche KB500123'."
                    },
                    { 
                        text: "Cifrar los datos en tránsito y en reposo para cumplir con la Ley 1581.",
                        isCorrect: false,
                        feedback: "Incorrecto. El cifrado se logra con tecnologías como TLS (en tránsito) o BitLocker/TDE (en reposo). Un SIEM no cifra datos.",
                        example: "Se usa un certificado digital en el servidor web del SIA para habilitar HTTPS (TLS). El SIEM solo registraría el log de esa conexión."
                    },
                    { 
                        text: "Agregar, correlacionar y analizar logs de múltiples fuentes (firewalls, servidores, etc.) para detectar amenazas complejas.",
                        isCorrect: true,
                        feedback: "¡Correcto! Un SIEM es el 'cerebro' del SOC. Recibe logs de *todas* las demás herramientas y los correlaciona para encontrar patrones que una herramienta individual no vería.",
                        example: "El SIEM de la UNAL recibe un log del Firewall (IP de Rusia), 100 logs de login fallido del SIA (ataque de fuerza bruta), y un log del Antivirus (malware detectado), todo en 5 minutos. El SIEM correlaciona esto y genera una *única alerta crítica* de 'Incidente de Intrusión en Curso'."
                    }
                ],
                correctAnswerExplanation: "Un SIEM (como Splunk, QRadar, o ELK Stack) es una herramienta de *análisis y visibilidad*. Su poder no está en bloquear, sino en *detectar* amenazas avanzadas (como Amenazas Persistentes Avanzadas - APTs) mediante la correlación de eventos aparentemente no relacionados de diversas fuentes de datos.",
                correctAnswerExample: "Un atacante roba las credenciales de un docente de la UNAL. El Firewall no ve nada malo (es un login legítimo). El servidor tampoco (es un login exitoso). Pero el SIEM detecta que este 'login exitoso' proviene de una IP en un país donde el docente nunca ha estado (correlacionando logs de VPN y logs del SIA), y genera una alerta de 'Cuenta Comprometida'."
            },
            // ... (Añadir 28 preguntas más de Redes/Cloud) ...

            // --- BLOQUE 5: AUDITORÍA, FORENSE & SSDLC (Preguntas 121-150) ---
            {
                question: "Durante un análisis forense digital de un computador en la UNAL, ¿cuál es el primer y más crítico paso a seguir para preservar la evidencia?",
                options: [
                    { 
                        text: "Encender el equipo y empezar a buscar archivos sospechosos en el escritorio.",
                        isCorrect: false,
                        feedback: "Incorrecto. ¡Esto es lo *peor* que se puede hacer! Encender el equipo altera miles de archivos (logs, timestamps, archivos temporales) y destruye evidencia volátil (como la memoria RAM).",
                        example: "Al encender un PC con Windows, el S.O. escribe en el log de eventos, modifica el prefetch y sobrescribe datos en la memoria RAM, destruyendo la escena del crimen digital."
                    },
                    { 
                        text: "Desconectar el equipo de la red, apagarlo, y crear una imagen forense (copia bit a bit) del disco duro.",
                        isCorrect: true,
                        feedback: "¡Correcto! La prioridad #1 es la 'Preservación de la Evidencia'. Esto implica 1. Aislar (desconectar red/wifi) y 2. Crear una imagen forense *antes* de hacer cualquier análisis. Todo el análisis se hace sobre la *copia*, nunca sobre el original.",
                        example: "El equipo forense de la UNAL usa un bloqueador de escritura (write-blocker) para conectar el disco duro original y usar una herramienta (como FTK Imager) para crear una imagen E01 (copia exacta) en un disco duro limpio."
                    },
                    { 
                        text: "Ejecutar un análisis completo de antivirus para encontrar y eliminar el malware.",
                        isCorrect: false,
                        feedback: "Incorrecto. Ejecutar un antivirus *altera* la evidencia (elimina archivos, los mueve a cuarentena) y corrompe la cadena de custodia. El análisis se hace *después*, sobre la copia forense.",
                        example: "Si el antivirus elimina un 'ransomware.exe', el analista forense pierde la oportunidad de analizar cómo funcionaba ese malware (ej. a qué C&C se conectaba)."
                    },
                    { 
                        text: "Entrevistar al usuario del equipo para saber qué hizo.",
                        isCorrect: false,
                        feedback: "Incorrecto. La entrevista es importante para la investigación, pero no es el primer paso *técnico* de preservación de evidencia. La evidencia digital es volátil y debe capturarse primero.",
                        example: "Mientras entrevistas al docente, la memoria RAM del equipo (que contenía la clave de cifrado del atacante) se pierde porque el equipo se apagó incorrectamente."
                    }
                ],
                correctAnswerExplanation: "La regla de oro del análisis forense digital es 'Preservar el Original'. Nunca se trabaja directamente sobre la evidencia original. El procedimiento estándar es 1. Asegurar la escena (aislar), 2. Crear una imagen forense (copia bit a bit) usando un bloqueador de escritura, 3. Establecer y documentar la Cadena de Custodia, 4. Realizar todo el análisis sobre la copia.",
                correctAnswerExample: "Para investigar un caso de fuga de información en un computador de un administrativo de la UNAL, el investigador debe crear la imagen forense, calcular su hash (ej. SHA-256) y documentarlo. Luego, trabaja sobre una copia de esa imagen. El hash prueba que la copia es idéntica al original."
            },
            {
                question: "¿Qué tipo de prueba de seguridad (SAST o DAST) se utiliza para analizar el código fuente de una aplicación *sin ejecutarla*?",
                options: [
                    { 
                        text: "DAST (Dynamic Application Security Testing)",
                        isCorrect: false,
                        feedback: "Incorrecto. DAST (Dinámico) significa que la aplicación *debe estar en ejecución*. DAST actúa como un atacante externo, enviando peticiones maliciosas.",
                        example: "Un escáner DAST (como OWASP ZAP) ataca la URL 'sia.unal.edu.co' en el servidor de pruebas, intentando inyecciones SQL en el formulario de login."
                    },
                    { 
                        text: "SAST (Static Application Security Testing)",
                        isCorrect: true,
                        feedback: "¡Correcto! SAST (Estático) analiza el código fuente o binario de la aplicación 'en reposo', sin ejecutarla. Es como una revisión de código automatizada en busca de patrones de vulnerabilidad.",
                        example: "Un desarrollador de la UNAL pasa una herramienta SAST (como SonarQube) sobre el código Java del SIA *antes* de compilarlo, y la herramienta reporta: 'Peligro de Inyección SQL en la línea 45 del archivo UserDAO.java'."
                    },
                    { 
                        text: "IAST (Interactive Application Security Testing)",
                        isCorrect: false,
                        feedback: "Incorrecto. IAST (Interactivo) es un híbrido que combina SAST y DAST, usando un 'agente' dentro de la aplicación mientras se ejecuta DAST para ver el flujo del código.",
                        example: "Una herramienta IAST monitorea el código del SIA *mientras* ZAP (DAST) lo ataca, permitiendo ver exactamente qué línea de código fue vulnerable."
                    },
                    { 
                        text: "SCA (Software Composition Analysis)",
                        isCorrect: false,
                        feedback: "Incorrecto. SCA se enfoca únicamente en analizar las *dependencias y librerías de terceros* (ej. log4j, spring-boot) en busca de vulnerabilidades conocidas.",
                        example: "Una herramienta SCA (como Snyk) escanea el proyecto del SIA y alerta: 'Están usando la librería 'log4j 2.14', que es vulnerable a Log4Shell. Actualizar a 2.17'."
                    }
                ],
                correctAnswerExplanation: "En un Ciclo de Desarrollo Seguro (SSDLC), SAST y DAST son complementarios. SAST ('White-box') se usa temprano en el ciclo (en el código) para encontrar fallas de implementación. DAST ('Black-box') se usa más tarde (en la aplicación en ejecución) para encontrar fallas de configuración y de lógica de negocio.",
                correctAnswerExample: "SAST es excelente para encontrar un 'SQL Injection' en el código. DAST es excelente para encontrar un 'Control de Acceso Roto' (ej. un estudiante puede ver las notas de otro cambiando el ID en la URL), algo que SAST no podría ver."
            },
            // ... (Añadir 28 preguntas más de Auditoría/Forense/SSDLC) ...
            
            // (Pregunta 150)
            {
                question: "En una auditoría de SGSI a la UNAL, el auditor encuentra que '5 usuarios desvinculados hace 3 meses aún tienen acceso activo al SIA'. ¿Cómo se clasificaría este hallazgo?",
                options: [
                    { 
                        text: "Como una 'Observación' o 'Área de Mejora'.",
                        isCorrect: false,
                        feedback: "Incorrecto. Una Observación es una debilidad que *podría* convertirse en un problema. Esto ya es un problema grave y un incumplimiento directo.",
                        example: "Una 'Observación' sería: 'El proceso de desvinculación es manual y depende de un correo. Se recomienda automatizarlo para evitar futuros fallos'."
                    },
                    { 
                        text: "Como una 'No Conformidad Menor'.",
                        isCorrect: false,
                        feedback: "Incorrecto. Una 'No Conformidad Menor' es un fallo puntual o un desliz administrativo (ej. falta una firma en un documento). 5 cuentas activas durante 3 meses es un fallo sistémico y grave del control de acceso.",
                        example: "Una 'No Conformidad Menor' sería: 'El formulario de solicitud de acceso de un usuario no fue firmado por el gerente, aunque el acceso sí fue aprobado por correo'."
                    },
                    { 
                        text: "Como una 'No Conformidad Mayor'.",
                        isCorrect: true,
                        feedback: "¡Correcto! Esto es una 'No Conformidad Mayor' (o Crítica). Representa un fallo total y sistémico de un control de seguridad mandatorio (A.9.2.6 - Revocación de acceso) y expone a la organización a un riesgo significativo e inaceptable (fraude, fuga de datos).",
                        example: "Un auditor declararía una 'No Conformidad Mayor' porque el control de desvinculación (uno de los más críticos) no está funcionando, lo que podría llevar a la pérdida de la certificación ISO 27001 si no se corrige de inmediato."
                    },
                    { 
                        text: "Como un 'Punto Fuerte' del SGSI.",
                        isCorrect: false,
                        feedback: "Incorrecto. Esto es evidentemente una debilidad crítica, no una fortaleza.",
                        example: "Un 'Punto Fuerte' sería: 'Se evidenció un proceso automatizado que revoca todos los accesos del SIA y Directorio Activo a los 5 minutos de que RRHH marca a un usuario como 'retirado'."
                    }
                ],
                correctAnswerExplanation: "En las auditorías ISO 27001, los hallazgos se clasifican por severidad. Una 'Observación' es una sugerencia. Una 'No Conformidad Menor' es un fallo aislado que no compromete el SGSI. Una 'No Conformidad Mayor' es un fallo grave y sistémico de un requisito de la norma que *sí* compromete la eficacia del SGSI y debe ser corregido de inmediato.",
                correctAnswerExample: "Encontrar un PC sin antivirus es una 'No Conformidad Menor'. Encontrar que *ningún* servidor tiene antivirus o que el control de desvinculación no existe en la práctica, es una 'No Conformidad Mayor'."
            }
        ];

        // --- LÓGICA DEL CUESTIONARIO ---

        let currentQuestionIndex = 0;
        let score = 0;
        let attemptNumber = 1;
        let questionsForThisAttempt = [];

        // Elementos del DOM
        const progressTextEl = document.getElementById('progress-text');
        const attemptTextEl = document.getElementById('attempt-text');
        const scoreTextEl = document.getElementById('score-text');
        const progressBarEl = document.getElementById('progress-bar');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainerEl = document.getElementById('options-container');
        const nextBtnEl = document.getElementById('next-btn');
        
        // Elementos de Feedback (Modificados)
        const feedbackContainerEl = document.getElementById('feedback-container');
        const feedbackTitleEl = document.getElementById('feedback-title');
        const feedbackTextEl = document.getElementById('feedback-text');
        const feedbackExampleTextEl = document.getElementById('feedback-example-text');
        
        const correctAnswerContainerEl = document.getElementById('correct-answer-container');
        const correctAnswerTextEl = document.getElementById('correct-answer-text');
        const correctAnswerExampleTextEl = document.getElementById('correct-answer-example-text');

        // Elementos de Resultados
        const quizContainerEl = document.getElementById('quiz-container');
        const resultsContainerEl = document.getElementById('results-container');
        const scoreFinalEl = document.getElementById('score-final');
        const resultsMessageEl = document.getElementById('results-message');
        const resultsAttemptTextEl = document.getElementById('results-attempt-text');
        const retryBtnEl = document.getElementById('retry-btn');

        // Función para barajar un array (Fisher-Yates)
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        // 1. Cargar el banco de preguntas según el intento (Lógica MODIFICADA)
        function loadQuestionBank() {
            // Usar una clave de localStorage específica para el Módulo 2
            attemptNumber = parseInt(localStorage.getItem('quizAttempt_M2') || '1');
            attemptTextEl.textContent = `Intento: ${attemptNumber}`;
            
            const totalQuestions = allQuestions.length; // 150
            const questionsPerAttempt = 30; // Mostrar 30 preguntas por intento

            if (attemptNumber === 1) {
                // Intento 1: Preguntas 1-30 (Índices 0-29)
                questionsForThisAttempt = allQuestions.slice(0, 30);
            } else if (attemptNumber === 2) {
                // Intento 2: Preguntas 31-60 (Índices 30-59)
                questionsForThisAttempt = allQuestions.slice(30, 60);
            } else if (attemptNumber === 3) {
                // Intento 3: Preguntas 61-90 (Índices 60-89)
                questionsForThisAttempt = allQuestions.slice(60, 90);
            } else if (attemptNumber === 4) {
                // Intento 4: Preguntas 91-120 (Índices 90-119)
                questionsForThisAttempt = allQuestions.slice(90, 120);
            } else if (attemptNumber === 5) {
                // Intento 5: Preguntas 121-150 (Índices 120-149)
                questionsForThisAttempt = allQuestions.slice(120, 150);
            } else {
                // Intento 6 en adelante: 30 preguntas aleatorias de todo el banco
                attemptTextEl.textContent = `Intento: ${attemptNumber} (Modo Aleatorio)`;
                questionsForThisAttempt = shuffle([...allQuestions]).slice(0, questionsPerAttempt);
            }
        }

        // 2. Mostrar la pregunta actual
        function displayQuestion() {
            // Resetear UI
            feedbackContainerEl.classList.add('hidden');
            correctAnswerContainerEl.classList.add('hidden'); // Resetear nuevo contenedor
            nextBtnEl.classList.add('hidden');
            optionsContainerEl.innerHTML = ''; // Limpiar opciones anteriores

            if (currentQuestionIndex >= questionsForThisAttempt.length) {
                showResults();
                return;
            }

            const question = questionsForThisAttempt[currentQuestionIndex];
            const questionNumber = currentQuestionIndex + 1;
            const totalQuestions = questionsForThisAttempt.length;

            // Actualizar textos y progreso
            questionTextEl.textContent = question.question;
            progressTextEl.textContent = `Pregunta ${questionNumber} de ${totalQuestions}`;
            progressBarEl.style.width = `${(questionNumber / totalQuestions) * 100}%`;

            // Crear botones de opción (barajados)
            const shuffledOptions = shuffle([...question.options]);
            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.innerHTML = option.text; // Usar innerHTML por si hay tags
                button.classList.add('option-btn', 'w-full', 'p-5', 'text-left', 'text-lg', 'bg-gray-700', 'rounded-lg', 'border-2', 'border-gray-600');
                
                // Pasar el objeto 'question' completo a selectAnswer
                button.onclick = (event) => selectAnswer(event, option, question);
                optionsContainerEl.appendChild(button);
            });
        }

        // 3. Manejar la selección de respuesta (Lógica MODIFICADA)
        function selectAnswer(event, selectedOption, question) {
            // Deshabilitar todos los botones
            Array.from(optionsContainerEl.children).forEach(btn => {
                btn.disabled = true;
                btn.classList.add('opacity-50');
            });

            // Mostrar feedback
            feedbackContainerEl.classList.remove('hidden');
            
            // 1. Mostrar feedback de la opción seleccionada
            feedbackTextEl.textContent = selectedOption.feedback;
            feedbackExampleTextEl.textContent = `Ejemplo: ${selectedOption.example}`;


            if (selectedOption.isCorrect) {
                // --- Respuesta Correcta ---
                score++;
                scoreTextEl.textContent = score;
                feedbackTitleEl.textContent = "¡Correcto!";
                feedbackContainerEl.classList.remove('bg-red-900', 'border-red-700');
                feedbackContainerEl.classList.add('bg-green-900', 'border', 'border-green-700');
                event.target.classList.add('correct');

            } else {
                // --- Respuesta Incorrecta ---
                feedbackTitleEl.textContent = "Respuesta Incorrecta";
                feedbackContainerEl.classList.remove('bg-green-900', 'border-green-700');
                feedbackContainerEl.classList.add('bg-red-900', 'border', 'border-red-700');
                event.target.classList.add('incorrect');

                // 2. Resaltar la correcta
                const correctOptionData = question.options.find(opt => opt.isCorrect);
                Array.from(optionsContainerEl.children).forEach(btn => {
                    if (btn.innerHTML === correctOptionData.text) {
                        btn.classList.add('correct');
                        btn.classList.remove('opacity-50');
                    }
                });

                // 3. Mostrar la explicación de la respuesta correcta
                correctAnswerContainerEl.classList.remove('hidden');
                correctAnswerTextEl.textContent = question.correctAnswerExplanation;
                correctAnswerExampleTextEl.textContent = `Ejemplo: ${question.correctAnswerExample}`;
            }

            // Mostrar botón de siguiente
            nextBtnEl.classList.remove('hidden');
        }

        // 4. Ir a la siguiente pregunta
        function nextQuestion() {
            currentQuestionIndex++;
            displayQuestion();
        }

        // 5. Mostrar resultados finales
        function showResults() {
            quizContainerEl.classList.add('hidden');
            resultsContainerEl.classList.remove('hidden');

            const totalQuestions = questionsForThisAttempt.length;
            scoreFinalEl.textContent = `${score} / ${totalQuestions}`;
            resultsAttemptTextEl.textContent = `Resultados de tu Intento ${attemptNumber}`;
            retryBtnEl.textContent = "Siguiente Intento"; // Cambiar texto del botón

            // Mensaje de resultado
            const percentage = (score / totalQuestions) * 100;
            if (percentage >= 90) {
                resultsMessageEl.textContent = "¡Excelente! Dominio total del módulo. ¡Estás listo!";
            } else if (percentage >= 70) {
                resultsMessageEl.textContent = "¡Muy bien! Tienes bases sólidas. Repasa los puntos donde fallaste.";
            } else {
                resultsMessageEl.textContent = "Buen esfuerzo. Sigue practicando. La retroalimentación es clave. ¡Inténtalo de nuevo!";
            }

            // Preparar el siguiente intento
            localStorage.setItem('quizAttempt_M2', (attemptNumber + 1).toString());
        }

        // 6. Reiniciar el quiz (para el siguiente intento)
        function retryQuiz() {
            window.location.reload();
        }

        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            loadQuestionBank();
            displayQuestion();
        });

        nextBtnEl.addEventListener('click', nextQuestion);
        retryBtnEl.addEventListener('click', retryQuiz);

    </script>
</body>
</html>
